{% extends "admin/change_list.html" %}
{% load i18n admin_urls static %}

{% block extrahead %}
    {{ block.super }}
    <style>
        /* Usar las variables CSS del diseÃ±o corporativo */
        .admin-object-tools {
            margin-bottom: var(--spacing-6);
        }
        
        .custom-header {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
            color: var(--color-white);
            padding: var(--spacing-6);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-6);
            box-shadow: var(--shadow-lg);
            text-align: center;
        }
        
        .custom-header h1 {
            margin: 0;
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .custom-header p {
            margin: var(--spacing-2) 0 0 0;
            opacity: 0.9;
            font-size: var(--font-size-sm);
        }
        
        .field-plato_link a {
            font-weight: var(--font-weight-semibold) !important;
            color: var(--color-primary) !important;
            text-decoration: none !important;
            padding: var(--spacing-2) var(--spacing-3) !important;
            border-radius: var(--radius-sm) !important;
            transition: var(--transition-fast) !important;
            display: inline-block !important;
        }
        
        .field-plato_link a:hover {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%) !important;
            color: var(--color-white) !important;
            transform: translateX(3px) !important;
            box-shadow: var(--shadow-sm) !important;
        }
        
        .field-editar_link a {
            background: linear-gradient(135deg, var(--color-accent) 0%, #ff8a80 100%) !important;
            color: var(--color-white) !important;
            padding: var(--spacing-2) var(--spacing-4) !important;
            border-radius: var(--radius-md) !important;
            text-decoration: none !important;
            font-size: var(--font-size-xs) !important;
            font-weight: var(--font-weight-semibold) !important;
            transition: var(--transition-fast) !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: var(--spacing-1) !important;
            box-shadow: var(--shadow-sm) !important;
        }
        
        .field-editar_link a:hover {
            background: linear-gradient(135deg, #ff5252 0%, var(--color-accent) 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: var(--shadow-md) !important;
        }
        
        .result-list tr:hover {
            background: linear-gradient(135deg, var(--color-gray-50) 0%, #fef7f7 100%) !important;
            cursor: pointer !important;
            transform: translateY(-1px) !important;
            box-shadow: var(--shadow-sm) !important;
        }
        
        .object-tools {
            margin-bottom: var(--spacing-6) !important;
            display: flex !important;
            flex-wrap: wrap !important;
            gap: var(--spacing-3) !important;
        }
        
        .object-tools li {
            margin: 0 !important;
        }
        
        .object-tools a {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%) !important;
            color: var(--color-white) !important;
            padding: var(--spacing-3) var(--spacing-6) !important;
            border-radius: var(--radius-md) !important;
            text-decoration: none !important;
            font-weight: var(--font-weight-semibold) !important;
            font-size: var(--font-size-sm) !important;
            transition: var(--transition-fast) !important;
            box-shadow: var(--shadow-sm) !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: var(--spacing-2) !important;
        }
        
        .object-tools a:hover {
            background: linear-gradient(135deg, var(--color-primary-dark) 0%, var(--color-primary) 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: var(--shadow-md) !important;
            color: var(--color-white) !important;
        }
        
        .addlink::before {
            content: "âž•";
            font-size: var(--font-size-sm);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-4);
            margin-bottom: var(--spacing-6);
        }
        
        .stat-card-mini {
            background: var(--color-white);
            border: 1px solid var(--color-gray-200);
            border-radius: var(--radius-md);
            padding: var(--spacing-4);
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-fast);
        }
        
        .stat-card-mini:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .stat-card-mini .number {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            margin-bottom: var(--spacing-1);
        }
        
        .stat-card-mini .label {
            font-size: var(--font-size-xs);
            color: var(--color-gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
{% endblock %}

{% block content_title %}
    <div class="custom-header">
        <h1>ðŸ“… GestiÃ³n de Disponibilidades</h1>
        <p>Administra cuÃ¡ndo estÃ¡n disponibles tus platos durante la semana</p>
    </div>
{% endblock %}

{% block result_list %}
    <!-- Mini estadÃ­sticas -->
    <div class="stats-grid">
        <div class="stat-card-mini">
            <div class="number" id="total-disponibilidades">{{ cl.result_count }}</div>
            <div class="label">Total Registros</div>
        </div>
        <div class="stat-card-mini">
            <div class="number" id="platos-unicos">-</div>
            <div class="label">Platos Ãšnicos</div>
        </div>
        <div class="stat-card-mini">
            <div class="number" id="dias-cubiertos">-</div>
            <div class="label">DÃ­as Cubiertos</div>
        </div>
        <div class="stat-card-mini">
            <div class="number" id="mas-popular">-</div>
            <div class="label">DÃ­a MÃ¡s Popular</div>
        </div>
    </div>
    
    {{ block.super }}
    
    <script>
    (function($) {
        $(document).ready(function() {
            console.log('âœ… Lista de disponibilidades con diseÃ±o corporativo cargada');
            
            // Calcular estadÃ­sticas dinÃ¡micas
            calculateStats();
            
            // Hacer toda la fila clickeable para editar
            $('.result-list tbody tr').each(function() {
                var $row = $(this);
                var editLink = $row.find('.field-editar_link a').attr('href');
                
                if (editLink) {
                    // Agregar evento click a toda la fila
                    $row.on('click', function(e) {
                        // Si no se hizo click en un enlace especÃ­fico
                        if (!$(e.target).is('a')) {
                            window.location.href = editLink;
                        }
                    });
                    
                    // Agregar indicador visual de que es clickeable
                    $row.css('cursor', 'pointer');
                }
            });
            
            console.log('âœ… Eventos de click configurados para', $('.result-list tbody tr').length, 'filas');
        });
        
        function calculateStats() {
            // Contar platos Ãºnicos
            var platosUnicos = new Set();
            var diasContador = {};
            
            $('.result-list tbody tr').each(function() {
                var platoText = $(this).find('.field-plato_link').text().trim();
                var diaText = $(this).find('.field-dia_display').text().trim();
                
                if (platoText) platosUnicos.add(platoText);
                if (diaText) {
                    diasContador[diaText] = (diasContador[diaText] || 0) + 1;
                }
            });
            
            // Actualizar estadÃ­sticas
            $('#platos-unicos').text(platosUnicos.size);
            $('#dias-cubiertos').text(Object.keys(diasContador).length);
            
            // Encontrar dÃ­a mÃ¡s popular
            var diaMasPopular = '';
            var maxCount = 0;
            for (var dia in diasContador) {
                if (diasContador[dia] > maxCount) {
                    maxCount = diasContador[dia];
                    diaMasPopular = dia;
                }
            }
            $('#mas-popular').text(diaMasPopular || 'N/A');
        }
    })(django.jQuery);
    </script>
{% endblock %}

{% block object-tools-items %}
    <li>
        <a href="{% url 'admin:myapp_disponibilidadplato_add' %}" class="addlink">
            Agregar Disponibilidad
        </a>
    </li>
    <li>
        <a href="{% url 'admin:myapp_plato_changelist' %}" class="viewlink" style="background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%) !important;">
            ðŸ“‹ Ver Platos
        </a>
    </li>
    <li>
        <a href="/test_admin_links/" class="viewlink" style="background: linear-gradient(135deg, #6c757d 0%, #868e96 100%) !important;">
            ðŸ”§ Test Enlaces
        </a>
    </li>
{% endblock %}